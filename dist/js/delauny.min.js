function BowyerWatson(a,b){b.getSuperTriangle();a.forEach(function(a){BowyerWatsonInsert(a,b)})}function BowyerWatsonInsert(a,b){var c=[];b.triangles.forEach(function(b){b.contains(a).inCircumcircle()&&c.push(b)});var d=[];c.forEach(function(a){a.edges.forEach(function(b){c.every(function(c){return c==a||!c.contains(b).inEdges()})&&d.push(b)})}),c.forEach(function(a){b.remove(a)}),d.forEach(function(c){b.add(new Triangle(c.vertices.concat(a)))})}function Point(a,b){this.x=a,this.y=b}function Triangle(a,b){this["new"]=!0,this.vertices=a,this.edges=[new Vector([this.vertices[0],this.vertices[1]]),new Vector([this.vertices[0],this.vertices[2]]),new Vector([this.vertices[1],this.vertices[2]])],this.circumRadius=this.calculateCircumRadius(),this.circumCenter=this.calculateCircumCenter(),this.col=this.randomColour(this.COLOURS)}function Triangulation(a){this.superTriangle=a,this.triangles=[a]}function Vector(a){this.vertices=a,this.length=this.calculateLength(a),this.midpoint=this.calculateMidpoint(a)}function generateBoundingTriangle(a,b,c){return c=c||.2*b,new Triangle([new Point(-(a/2),-c),new Point(1.5*a,-c),new Point(a/2,2*b+c)])}function generatePoints(a){var b=0,c=a.POINTS,d=[];for(b;c>b;b++){var e=new Point(Math.random()*(width+400)-200,Math.random()*(height+400)-200);a.getSuperTriangle().contains(e).inTriangle()&&d.push(e)}return d}function setBoundingTriangle(){width=svg.getBoundingClientRect().width,height=svg.getBoundingClientRect().height,boundingTriangle=generateBoundingTriangle(width,height,500)}function renderPolygons(a){a.triangles.forEach(function(a,b){svg.innerHTML+=polygonTemplate({triangle:a,j:b,fill:a.col})}),null!==svg.onmousedown?svg.classList.add("hover"):svg.classList.remove("hover")}function refresh(a){svg.innerHTML=null,renderPolygons(triangulation)}function resize(){setBoundingTriangle(),asyncRefresh()}function asyncRefresh(){triangulation=new Triangulation(boundingTriangle),setTimeout(function(){BowyerWatson(generatePoints(triangulation),triangulation),refresh(triangulation),svg.classList.remove("fadeOut"),svg.classList.add("fadeIn")},0),svg.classList.remove("fadeIn"),svg.classList.add("fadeOut")}function changeColor(){Triangle.prototype.COLOURS=compColours[Math.floor(Math.random()*compColours.length)],asyncRefresh()}function insert(a){BowyerWatsonInsert(new Point(a.offsetX,a.offsetY),triangulation),refresh(triangulation)}function paint(a){var b=new Point(a.offsetX,a.offsetY);triangulation.triangles.forEach(function(a){a.contains(b).inTriangle()&&(a.col=a.randomColour(Triangle.prototype.COLOURS))}),refresh(triangulation)}function toggleControls(){controls.className.indexOf("slideLeft")<0?(controls.classList.add("slideLeft"),controls.classList.add("rotateRight")):(controls.classList.remove("slideLeft"),controls.classList.remove("rotateRight"))}Point.prototype.minus=function(a){return new Point(this.x-a.x,this.y-a.y)},Handlebars.registerHelper("getPoints",function(a){var b="";return a.vertices.forEach(function(a){b+=a.x+","+a.y+" "}),b});var polygonTemplate=Handlebars.compile(document.getElementById("polygon-template").innerHTML);Triangle.prototype.COLOURS=["#ae02ae","#bbae02"],Triangle.prototype.vertex=function(a){return this.vertices[a]},Triangle.prototype.calculateCircumRadius=function(){var a=this.edges[0].length,b=this.edges[1].length,c=this.edges[2].length,d=Math.sqrt((a+b+c)*(b+c-a)*(c+a-b)*(a+b-c))||a/2;return d?a*b*c/d:a/2},Triangle.prototype.calculateCircumCenter=function(){var a=this.vertices[0],b=this.vertices[1],c=this.vertices[2],d=2*(a.x*(b.y-c.y)+b.x*(c.y-a.y)+c.x*(a.y-b.y)),e=((Math.pow(a.x,2)+Math.pow(a.y,2))*(b.y-c.y)+(Math.pow(b.x,2)+Math.pow(b.y,2))*(c.y-a.y)+(Math.pow(c.x,2)+Math.pow(c.y,2))*(a.y-b.y))/d,f=((Math.pow(a.x,2)+Math.pow(a.y,2))*(c.x-b.x)+(Math.pow(b.x,2)+Math.pow(b.y,2))*(a.x-c.x)+(Math.pow(c.x,2)+Math.pow(c.y,2))*(b.x-a.x))/d;return new Point(e,f)},Triangle.prototype.randomColour=function(a){var b=Math.round(Math.random())?a[0]:a[1],c=40*Math.random()-15,d=parseInt(b.slice(1),16),e=Math.round(2.55*c),f=(d>>16)+e,g=(d>>8&255)+e,h=(255&d)+e;return"#"+(16777216+65536*(255>f?1>f?0:f:255)+256*(255>g?1>g?0:g:255)+(255>h?1>h?0:h:255)).toString(16).slice(1)},Triangle.prototype.contains=function(a){return this._contains=a,this},Triangle.prototype.inCircumcircle=function(){return new Vector([this.circumCenter,this._contains]).length<=this.circumRadius?!0:!1},Triangle.prototype.inEdges=function(){var a=this._contains;return this.edges.some(function(b){return a.vertices[0]==b.vertices[0]&&a.vertices[1]==b.vertices[1]})},Triangle.prototype.inTriangle=function(){var a=this._contains,b=this.vertex(1).minus(this.vertex(0)),c=this.vertex(2).minus(this.vertex(0)),d=a.minus(this.vertex(0)),e=b.x*c.y-c.x*b.y,f=[(d.x*(b.y-c.y)+d.y*(c.x-b.x)+b.x*c.y-c.x*b.y)/e,(d.x*c.y-d.y*c.x)/e,(d.y*b.x-d.x*b.y)/e];return f.every(function(a){return a>=0&&1>=a})},Triangulation.prototype.add=function(a){this.triangles.push(a)},Triangulation.prototype.remove=function(a){var b=this.triangles.indexOf(a);this.triangles.splice(b,1)},Triangulation.prototype.getSuperTriangle=function(){return this.superTriangle},Vector.prototype.vertex=function(a){return this.vertices[a]},Vector.prototype.calculateLength=function(a){return Math.sqrt(Math.pow(Math.abs(a[0].x-a[1].x),2)+Math.pow(Math.abs(a[0].y-a[1].y),2))},Vector.prototype.calculateMidpoint=function(a){return new Point((a[0].x+a[1].x)/2,(a[0].y+a[1].y)/2)},Vector.prototype.calculateGradient=function(a){return(a[1].y-a[0].y)/(a[1].x-a[0].x)},Vector.prototype.minus=function(a){return new Vector([new Point(this.vertex(0)-a.vertex(0).x,this.vertex(0).y-a.vertex(0).y),new Point(this.vertex(1)-a.vertex(1).x,this.vertex(1).y-a.vertex(1).y)])};var svg,triangulation,boundingTriangle,width,height,compColours;svg=document.getElementById("svg"),svg.onmousedown=insert,compColours=[["#aa3939","#116611"],["#d16300","#02757f"],["#98a800","#70048a"],["#486325","#354b12"],["#552040","#40102d"],["#2e3842","#1c2935"],["#2e3842","#21b2a6"]],Triangle.prototype.COLOURS=compColours[Math.floor(Math.random()*compColours.length)],Triangulation.prototype.POINTS=75,setBoundingTriangle(),asyncRefresh();var s=new Slider("#triSlider",{min:25,max:250,step:1,value:75});s.on("slideStop",function(a){Triangulation.prototype.POINTS=a,asyncRefresh()}),document.addEventListener("keydown",function(a){82===a.keyCode&&changeColor()});var controls=document.getElementById("controls");document.getElementById("control-nav").onclick=function(){toggleControls()},document.addEventListener("keydown",function(a){67===a.keyCode&&toggleControls()});