function Cell(a,b,c){this.id="cell_"+a+"_"+b,this.x=a,this.y=b,this.alive=c}function Grid(a){this.ctx=a,this.grid=this.createGrid(),this.cells=[];var b=this;this.animate=function(){Grid.step(b)}}function resize(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,setScale(Grid.prototype.scale)}function pause(){clearInterval(gameoflife.id),delete gameoflife.id}function play(){gameoflife.id||(gameoflife.id=setInterval(gameoflife.animate,100))}function generate(){var a=parseInt(document.getElementById("form-x").value)||0,b=parseInt(document.getElementById("form-y").value)||0;if(a>=0&&b>=0){var c=Grid.prototype.patterns[document.getElementsByTagName("select")[0].value];gameoflife.createOffsetPattern(c,[a,b]),gameoflife.render()}}function setScale(a){var b=Cell.prototype.scale=Grid.prototype.scale=a;Grid.prototype.size={x:Math.ceil(canvas.width/b),y:Math.ceil(canvas.height/b)},gameoflife&&gameoflife.render()}function toggleCoords(){var a=document.getElementById("tooltip");a.classList.contains("show")?a.classList.remove("show"):a.classList.add("show")}function toggleControls(){controls.className.indexOf("slideLeft")<0?(controls.classList.add("slideLeft"),controls.classList.add("rotateRight")):(controls.classList.remove("slideLeft"),controls.classList.remove("rotateRight"))}Cell.prototype.kill=function(){this.alive=!1},Cell.prototype.resurrect=function(){this.alive=!0},Object.defineProperty(Cell.prototype,"isAlive",{get:function(){return this.alive}}),Cell.prototype.draw=function(a){a.beginPath(),a.fillStyle=this.fillColour||"black",this.strokeColour&&(a.strokeStyle=this.strokeColour,a.strokeRect(this.x*this.scale,this.y*this.scale,this.scale,this.scale),a.stroke()),a.rect(this.x*this.scale,this.y*this.scale,this.scale,this.scale),a.fill()},Grid.step=function(a){if(a.cells.length){a.resurrect(a.cells);for(var b=[],c=a.getBoundingLimits(),d=c.lx;d<=c.Lx;d++)for(var e=c.ly;e<=c.Ly;e++){var f=a.getCell(d,e),g=a.countNeighbours(f);if(3===g||f.isAlive&&2===g){var h=a.normalise(d,e);b.push(new Cell(h.x,h.y,!0))}}a.kill(a.cells),a.setCells(b.slice()),a.render()}},Grid.getPatterns=function(){var a=[];for(var b in Grid.prototype.patterns)a.push(b);return a},Grid.prototype.render=function(){var a=this.ctx;a.fillStyle=this.fillColour||"white",a.fillRect(0,0,this.width,this.height);var b=0,c=this.cells.length;for(b;c>b;b++)this.cells[b].draw(this.ctx)},Grid.prototype.countNeighbours=function(a){var b=a.isAlive?-1:0,c=this.getNeighbourLimits(a.x),d=this.getNeighbourLimits(a.y),e=this;return c.some(function(a){d.some(function(c){return e.getCell(a,c).isAlive&&(b+=1),b>3?!0:!1})}),b},Grid.prototype.getNeighbourLimits=function(a){return[a-1,a,a+1]},Grid.prototype.normalise=function(a,b){return a=(this.size.x+a)%this.size.x,b=(this.size.y+b)%this.size.y,{x:a,y:b}},Grid.prototype.getCell=function(a,b){var c=this.normalise(a,b);return this.grid[c.x][c.y]},Grid.prototype.getBoundingLimits=function(){var a=0,b=this.size.x,c=0,d=this.size.y;return this.cells.forEach(function(e){b=Math.min(e.x,b),a=Math.max(e.x,a),d=Math.min(e.y,d),c=Math.max(e.y,c)}),{lx:b-1,Lx:a+1,ly:d-1,Ly:c+1}},Object.defineProperty(Grid.prototype,"width",{get:function(){return this.ctx.canvas.width}}),Object.defineProperty(Grid.prototype,"height",{get:function(){return this.ctx.canvas.height}}),Grid.prototype.createGrid=function(){for(var a={},b=0;b<this.size.x;b++){a[b]={};for(var c=0;c<this.size.y;c++)a[b][c]=new Cell(b,c,!1)}return a},Grid.prototype.setCells=function(a){this.cells=a},Grid.prototype.perform=function(a){var b=this.grid;return{on:function(c){c.forEach(function(c){b[c.x][c.y][a]()})}}},Grid.prototype.resurrect=function(a){this.perform("resurrect").on(a)},Grid.prototype.kill=function(a){this.perform("kill").on(a)},Grid.prototype.clear=function(){this.cells=[],this.render()},Grid.prototype.patterns={},Grid.prototype.patterns.spaceship=[[0,0],[0,2],[1,3],[2,3],[3,0],[3,3],[4,1],[4,2],[4,3]],Grid.prototype.patterns.glider=[[0,0],[2,0],[1,1],[2,1],[1,2]],Grid.prototype.patterns.glider=[[0,0],[2,0],[1,1],[2,1],[1,2]],Grid.prototype.patterns.blinker=[[0,0],[0,1],[0,2]],Grid.prototype.patterns.toad=[[0,3],[0,2],[1,4],[2,1],[3,2],[3,3]],Grid.prototype.patterns.gosperglidergun=[[0,4],[1,4],[0,5],[1,5],[35,2],[35,3],[34,2],[34,3],[10,4],[10,5],[10,6],[11,3],[11,7],[12,2],[12,8],[13,2],[13,8],[14,5],[15,3],[15,7],[16,4],[16,5],[16,7],[17,5],[20,2],[20,3],[20,4],[21,2],[21,3],[21,4],[22,1],[22,5],[24,0],[24,1],[24,5],[24,6]],Grid.prototype.patterns.pulsar=[[4,1],[5,1],[6,1],[10,1],[11,1],[12,1],[4,6],[5,6],[6,6],[10,6],[11,6],[12,6],[4,8],[5,8],[6,8],[10,8],[11,8],[12,8],[4,13],[5,13],[6,13],[10,13],[11,13],[12,13],[2,3],[2,4],[2,5],[2,9],[2,10],[2,11],[7,3],[7,4],[7,5],[7,9],[7,10],[7,11],[9,3],[9,4],[9,5],[9,9],[9,10],[9,11],[14,3],[14,4],[14,5],[14,9],[14,10],[14,11]],Grid.prototype.createCell=function(a,b){a<this.size.x&&b<this.size.y&&this.cells.push(new Cell(a,b,!0))},Grid.prototype.createPulsar=function(a,b){this.createOffsetPattern(this.patterns.pulsar,[a,b])},Grid.prototype.createGlider=function(a,b){this.createOffsetPattern(this.patterns.glider,[a,b])},Grid.prototype.createSpaceship=function(a,b){this.createOffsetPattern(this.patterns.spaceship,[a,b])},Grid.prototype.createGosperGliderGun=function(a,b){this.createOffsetPattern(this.patterns.gosperglidergun,[a,b])},Grid.prototype.createOffsetPattern=function(a,b){var c=this,d=a.map(function(a){return a.map(function(a,c){return a+b[c]})});d.forEach(function(a){c.createCell(a[0],a[1])})},Handlebars.registerHelper("list",function(a){for(var b='<select class="form-control" name="Game of Life pattern">',c=0,d=a.length;d>c;c++)b+="<option>"+a[c]+"</option>";return b+="</select>"});var template=Handlebars.compile(document.getElementById("patterns-template").innerHTML),context={patterns:Grid.getPatterns()};document.getElementById("patterns").innerHTML+=template(context),Cell.prototype.strokeColour="white",Cell.prototype.fillColour="#393838",Grid.prototype.size={x:120,y:40},Grid.prototype.scale=20,Array.prototype.find=function(a){var b=-1;return this.forEach(function(c,d){c.id===a.id&&(b=d)}),b};var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");resize();var gameoflife;gameoflife=new Grid(ctx),gameoflife.clear(),gameoflife.id=setInterval(gameoflife.animate,100);var s=new Slider("#scaleSlider",{min:30,max:100,step:1});s.on("change",function(a){setScale(a.newValue)}),canvas.onmousemove=function(a){var b=document.getElementById("tooltip"),c=Math.floor(a.offsetX/Grid.prototype.scale),d=Math.floor(a.offsetY/Grid.prototype.scale);b.style.left=a.offsetX+"px",b.style.top=a.offsetY-20+"px",b.textContent="( x: "+c+", y: "+d+" )"},canvas.addEventListener("mousedown",function(a){var b=Math.floor(a.offsetX/Grid.prototype.scale),c=Math.floor(a.offsetY/Grid.prototype.scale),d=gameoflife.cells.find(gameoflife.getCell(b,c));0>d?gameoflife.createCell(b,c):gameoflife.cells.splice(d,1),gameoflife.render()}),document.addEventListener("keydown",function(a){84===a.keyCode&&toggleCoords(),82===a.keyCode&&gameoflife.clear(),71===a.keyCode&&generate(),80===a.keyCode&&(gameoflife.id?pause():play())});var controls=document.getElementById("controls");document.getElementById("control-nav").onclick=function(){toggleControls()},document.addEventListener("keydown",function(a){67===a.keyCode&&toggleControls()});