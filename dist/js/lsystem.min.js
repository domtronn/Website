function Grammar(a,b,c,d,e,f){this.type=a,void 0===b?this.vector=new Vector(new Point(0,0),LSystem.prototype.M*LSystem.prototype.M_SCALE,new Point(0,1)).rotate(LSystem.prototype.INITIAL_ANGLE).setColor(f):this.vector=new Vector(b.getEndPoint(),b.m*LSystem.prototype.M_SCALE,b.getDirection()).rotate(d).scale(e).setColor(f),this.rule=c}function C(a){return new Grammar("C",a,function(a){return[new A(a),new B(a),new C(a)]},this.ROTATION,this.SCALE,this.COLOR)}function B(a){return new Grammar("B",a,function(a){return[new B(a),new C(a)]},this.ROTATION,this.SCALE,this.COLOR)}function A(a){return new Grammar("A",a,function(a){return[new A(a),new B(a)]},this.ROTATION,this.SCALE,this.COLOR)}function LSystem(a){var b,c=[a],d=0,e=this.N;for(d;e>d;d++)b=[],c.forEach(function(a){ctx.lineWidth=LSystem.prototype.LINE_WIDTH/(d+1)*LSystem.prototype.LINE_SCALE,a.vector&&a.vector.draw(d===e-1),b=b.concat(a.rule(a.vector))}),c=b.slice();return new Vector}function Vector(a,b,c){return this.o=a,this.m=b,this.d=c||new Point(0,1),this}function Point(a,b){this.x=a,this.y=b,this.normal={x:a+this.OFFSET,y:height-b}}function toggleMouse(){canvas.onmousemove?canvas.onmousemove=null:canvas.onmousemove=onMouseMove,A.prototype.ROTATION_BASE=A.prototype.ROTATION,B.prototype.ROTATION_BASE=B.prototype.ROTATION,C.prototype.ROTATION_BASE=C.prototype.ROTATION}function toggleDebug(){LSystem.prototype.DEBUG=!LSystem.prototype.DEBUG,redraw()}function resize(){width=ctx.canvas.width=window.innerWidth,height=ctx.canvas.height=window.innerHeight,s6.setAttribute("max",width),s6.setValue(width/2),y,Point.prototype.OFFSET=width/2,redraw()}function resetVars(){Point.prototype.OFFSET=width/2,A.prototype.ROTATION_BASE=A.prototype.ROTATION=-30,B.prototype.ROTATION_BASE=B.prototype.ROTATION=30,C.prototype.ROTATION_BASE=C.prototype.ROTATION=20,A.prototype.SCALE=1.1,B.prototype.SCALE=.9,C.prototype.SCALE=1,A.prototype.COLOR="#e74c3c",B.prototype.COLOR="#3498db",C.prototype.COLOR="#2ecc71",LSystem.prototype.N=10,LSystem.prototype.M=250,LSystem.prototype.M_SCALE=.75,LSystem.prototype.LINE_WIDTH=20,LSystem.prototype.LINE_SCALE=1,LSystem.prototype.INITIAL_ANGLE=0,redraw()}function onMouseMove(a){var b=Math.min(Math.floor(18-18*a.offsetY/height),LSystem.prototype.MOUSE_LIMIT);mouse.n=Math.min(18-18*a.offsetY/height,10)-b,LSystem.prototype.N=b;var c=80*a.offsetX/width-40;C.prototype.ROTATION=C.prototype.ROTATION_BASE+c,B.prototype.ROTATION=B.prototype.ROTATION_BASE+c,A.prototype.ROTATION=A.prototype.ROTATION_BASE+c,sa.setValue(A.prototype.ROTATION),sb.setValue(B.prototype.ROTATION),sc.setValue(C.prototype.ROTATION),redraw()}function redraw(){ctx.clearRect(0,0,width,height),new LSystem(new A(void 0,!0))}function toggleControls(){controls.className.indexOf("slideLeft")<0?(controls.classList.add("slideLeft"),controls.classList.add("rotateRight")):(controls.classList.remove("slideLeft"),controls.classList.remove("rotateRight"))}LSystem.prototype.DEBUG=!1,LSystem.prototype.MOUSE_LIMIT=10,LSystem.prototype.MAX_ANGLE=80,Vector.prototype.scale=function(a){return this.m*=a,this},Vector.prototype.rotate=function(a){var b=a*(Math.PI/180)*-1,c=Math.cos(b)*this.d.x-Math.sin(b)*this.d.y,d=Math.sin(b)*this.d.x+Math.cos(b)*this.d.y;return this.d=new Point(c,d),this},Vector.prototype.setColor=function(a){return this.col=a,this},Vector.prototype.draw=function(a){return ctx.beginPath(),ctx.moveTo(this.o.normal.x,this.o.normal.y),ctx.strokeStyle=LSystem.prototype.DEBUG?this.col:"#212121",this.m=a?this.m*mouse.n:this.m,ctx.lineTo(this.o.normal.x+this.d.x*this.m,this.o.normal.y-this.d.y*this.m),ctx.stroke(),this},Vector.prototype.getDirection=function(){return this.d},Vector.prototype.getEndPoint=function(){return new Point(this.o.x+this.d.x*this.m,this.o.y+this.d.y*this.m)};var canvas,ctx,width,height,mouse;canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),width=ctx.canvas.width=window.innerWidth,height=ctx.canvas.height=window.innerHeight,mouse={},resetVars(),redraw(),document.addEventListener("keydown",function(a){82===a.keyCode&&resetVars()&&redraw(),68===a.keyCode&&toggleDebug(),77===a.keyCode&&toggleMouse()});var s1=new Slider("#nSlider",{min:0,max:12,step:1,value:LSystem.prototype.N});s1.on("change",function(a){LSystem.prototype.N=a.newValue,redraw()});var sa=new Slider("#aSlider",{min:-LSystem.prototype.MAX_ANGLE,max:LSystem.prototype.MAX_ANGLE,step:1,value:A.prototype.ROTATION});sa.on("change",function(a){A.prototype.ROTATION_BASE=A.prototype.ROTATION=a.newValue,redraw()});var sa_s=new Slider("#aScaleSlider",{min:.5,max:1.5,step:.01,value:A.prototype.SCALE});sa_s.on("change",function(a){A.prototype.SCALE=a.newValue,redraw()});var sb=new Slider("#bSlider",{min:-LSystem.prototype.MAX_ANGLE,max:LSystem.prototype.MAX_ANGLE,step:1,value:B.prototype.ROTATION});sb.on("change",function(a){B.prototype.ROTATION_BASE=B.prototype.ROTATION=a.newValue,redraw()});var sb_s=new Slider("#bScaleSlider",{min:.5,max:1.5,step:.01,value:B.prototype.SCALE});sb_s.on("change",function(a){B.prototype.SCALE=a.newValue,redraw()});var sc=new Slider("#cSlider",{min:-LSystem.prototype.MAX_ANGLE,max:LSystem.prototype.MAX_ANGLE,value:C.prototype.ROTATION});sc.on("change",function(a){C.prototype.ROTATION_BASE=C.prototype.ROTATION=a.newValue,redraw()});var sc_s=new Slider("#cScaleSlider",{min:.5,max:1.5,step:.01,value:C.prototype.SCALE});sc_s.on("change",function(a){C.prototype.SCALE=a.newValue,redraw()});var s4=new Slider("#mSlider",{min:.5,max:1,step:.01,value:LSystem.prototype.M_SCALE});s4.on("change",function(a){LSystem.prototype.M_SCALE=a.newValue,redraw()});var s4_5=new Slider("#MSlider",{min:250,max:500,step:1,value:LSystem.prototype.M});s4_5.on("change",function(a){LSystem.prototype.M=a.newValue,redraw()});var s5=new Slider("#wSlider",{min:.5,max:1,step:.01,value:LSystem.prototype.LINE_SCALE});s5.on("change",function(a){LSystem.prototype.LINE_SCALE=a.newValue,redraw()});var s6=new Slider("#hSlider",{min:0,max:width,step:1,value:Point.prototype.OFFSET});s6.on("change",function(a){Point.prototype.OFFSET=a.newValue,redraw()});var s7=new Slider("#iSlider",{min:-90,max:90,step:1,value:LSystem.prototype.INITIAL_ANGLE});s7.on("change",function(a){LSystem.prototype.INITIAL_ANGLE=a.newValue,redraw()});var controls=document.getElementById("controls");document.getElementById("control-nav").onclick=function(){toggleControls()},document.addEventListener("keydown",function(a){67===a.keyCode&&toggleControls()});